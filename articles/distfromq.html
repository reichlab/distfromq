<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="distfromq">
<title>distfromq • distfromq</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="distfromq">
<meta property="og:description" content="distfromq">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">distfromq</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/distfromq.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>distfromq</h1>
            
      
      
      <div class="d-none name"><code>distfromq.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>distfromq</code> package provides functions for
constructing an approximation to a probability distribution from a
finite set of quantiles of the distribution. The package provides four
main functions:</p>
<ol style="list-style-type: decimal">
<li>
<code>make_p_fn</code> returns a function that is analogous to
<code>pnorm</code>, and can be used to evaluate the approximated
cumulative distribution function (CDF).</li>
<li>
<code>make_d_fn</code> returns a function that is analogous to
<code>dnorm</code>, and can be used to evaluate the approximated
probability density function (PDF).</li>
<li>
<code>make_q_fn</code> returns a function that is analogous to
<code>qnorm</code>, and can be used to evaluate the approximated
quantile function (QF), i.e., the inverse CDF.</li>
<li>
<code>make_r_fn</code> returns a function that is analogous to
<code>rnorm</code>, and can be used to simulate a pseudo-random sample
from the approximated distribution.</li>
</ol>
<p>All four functions take a set of probability levels (<code>ps</code>)
and the corresponding quantiles (<code>qs</code>) of the distribution to
be approximated as inputs, as well as arguments specifying the methods
for interpolating those quantiles to estimate the interior of the
distribution, and for extrapolating into the tails of the distribution
using a specified parametric family.</p>
<p>The next section of the vignette describes the methods that are used
for approximating the distribution, and the following section gives
examples.</p>
</div>
<div class="section level2">
<h2 id="methods-description">Methods description<a class="anchor" aria-label="anchor" href="#methods-description"></a>
</h2>
<p>Suppose that we have a collection of pairs <span class="math inline">\((q_k, \tau_k)\)</span>, <span class="math inline">\(k = 1, \ldots, K\)</span>, where for each <span class="math inline">\(k\)</span>, <span class="math inline">\(\tau_k =
F(q_k)\)</span> or <span class="math inline">\(q_k =
F^{-1}(\tau_k)\)</span> for some distribution with CDF <span class="math inline">\(F\)</span> and quantile function <span class="math inline">\(F^{-1}\)</span>. We allow for the distribution to
have regions with no density or with discrete point masses,
corresponding to regions where <span class="math inline">\(F\)</span> is
flat or has a vertical step. In these instances, the points <span class="math inline">\((q_k, \tau_k)\)</span> may fall within the flat
region or partway up the vertical step, as will be illustrated below.
Our goal is to reconstruct an estimate of <span class="math inline">\(F\)</span>, the corresponding PDF <span class="math inline">\(f\)</span> (if the distribution is continuous),
and the QF <span class="math inline">\(F^{-1}\)</span>, as well as a
method for sampling from the distribution.</p>
<p>Our approach first splits the provided quantiles into a discrete part
of the distribution and a continuous part. Then, for the continuous part
it takes different strategies for interpolating on the interior of the
provided quantiles and for extrapolating into the tails. We outline
these procedures briefly here and give more detail below:</p>
<ol style="list-style-type: decimal">
<li>Split into discrete and continuous parts.
<ul>
<li>Discrete components of the distribution (i.e., point masses) are
identified in the following cases:
<ul>
<li>there are repeated quantiles across different probability levels
(i.e., <span class="math inline">\(q_k \approx q_{k'}\)</span> for
some indices <span class="math inline">\(k \neq k'\)</span>). In
this case, we say that there is a point mass at the value(s) of <span class="math inline">\(q\)</span> that was (were) repeated. The discrete
distribution assigns probability to each such point <span class="math inline">\(q\)</span> corresponding to <span class="math inline">\(\max(\{\tau_{k}: q_k \approx q\}) -
\min(\{\tau_{k}: q_k \approx q\})\)</span>. The parameter
<code>dup_tol</code> controls identification of quantiles that are
“close enough” to identify a point mass.</li>
<li>the parametric family to be used for extrapolation into the tails is
a lognormal distribution and there are one or more quantiles that are
approximately 0. In this case, we say that there is a point mass at
zero, with probability equal to <span class="math inline">\(\max(\{\tau_{k}: q_k \approx 0\})\)</span>. The
parameter <code>zero_tol</code> controls identification of quantiles
that are “close enough to zero” to identify a point mass.</li>
</ul>
</li>
<li>The result of this step is a collection of locations of discrete
point masses and their associated probabilities, and a set of quantiles
and associated probability levels that can be used for estimating the
continuous part of the distribution in the following step.</li>
</ul>
</li>
<li>Estimate the continuous part of the distribution.
<ul>
<li>On the interior of the quantiles for the continuous part of the
distribution, we estimate the continuous component using a monotonic
spline that interpolates the quantiles.</li>
<li>We approximate the tails with a distribution in a specified
location-scale family.</li>
</ul>
</li>
</ol>
<p>To estimate the quantile function (QF), we invert the estimate of the
CDF. To estimate the probability density function (PDF), we use the
derivative of the spline-based approximation to the CDF if there are no
discrete components. This function does not support estimation of a
density function if the distribution has any discrete components.</p>
<div class="section level3">
<h3 id="cdf-estimation-on-the-interior">CDF estimation on the interior<a class="anchor" aria-label="anchor" href="#cdf-estimation-on-the-interior"></a>
</h3>
<p>The continuous distribution is estimated based on a set of adjusted
quantile pairs that is obtained by eliminating duplicate quantiles,
subtracting the cumulative probabilities associated with the discrete
distribution, and renormalizing by the total probability mass associated
with the discrete distribution. To approximate the CDF of the continuous
distribution component at interior points, we fit a monotonic cubic
Hermite spline that interpolates the set of “observations” <span class="math inline">\(\{(q_1, \tau_1), \ldots, (q_K, \tau_K)\}\)</span>
(where these now denote the adjusted quantiles for the continuous
distribution component). This spline fit yields a “stage 1” CDF
estimate, <span class="math inline">\(\hat{F}^{(1)}\)</span>.</p>
<p>To address issues with numerical stability in inverting the spline in
the process of obtaining an estimate of the QF, we evaluate this stage 1
estimate at a grid of quantile values that are inserted between each
consecutive pair of input quantiles (the number of new quantile values
to use is an argument to the functions). We then use a “stage 2” CDF
estimate that linearly interpolates this augmented grid of <span class="math inline">\((q, \tau)\)</span> pairs. This behavior can be
disabled if desired, though this is not recommended.</p>
</div>
<div class="section level3">
<h3 id="cdf-estimation-in-the-tails">CDF estimation in the tails<a class="anchor" aria-label="anchor" href="#cdf-estimation-in-the-tails"></a>
</h3>
<p>We estimate the distribution for the left and right tails separately,
assuming that they come from a specified location-scale family. The
distributional family is assumed to be the same in each tail, but the
location and scale parameters may differ in the left and right tails.
Setting notation, suppose that <span class="math inline">\(Y = a + b
\cdot Z\)</span> where the random variable <span class="math inline">\(Z\)</span> has a specified distribution. Recall
that at the probability level <span class="math inline">\(\tau\)</span>,
a quantile of <span class="math inline">\(Y\)</span> can be calculated
in terms of the corresponding quantile of <span class="math inline">\(Z\)</span> via <span class="math inline">\(F_Y^{-1}(\tau) = a + b \cdot
F_Z^{-1}(\tau)\)</span>. Using the quantiles at two probability levels
<span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\tau_j\)</span>, we can calculate the value of
<span class="math inline">\(b\)</span> using</p>
<p><span class="math display">\[\begin{align*}
\frac{F_Y^{-1}(\tau_i) - F_Y^{-1}(\tau_j)}{F_Z^{-1}(\tau_i) -
F_Z^{-1}(\tau_j)} &amp;= \frac{a + b \cdot F_Z^{-1}(\tau_i) - (a + b
\cdot F_Z^{-1}(\tau_j))} {F_Z^{-1}(\tau_i) - F_Z^{-1}(\tau_j)} \\
&amp;= b \cdot \frac{F_Z^{-1}(\tau_i) -
F_Z^{-1}(\tau_j)}{F_Z^{-1}(\tau_i) - F_Z^{-1}(\tau_j)} \\
&amp;= b
\end{align*}\]</span></p>
<p>Similarly, we can calculate the value of <span class="math inline">\(a\)</span> as</p>
<p><span class="math display">\[F_Y^{-1}(\tau_i) - b \cdot
F_Z^{-1}(\tau_i) = a + b \cdot F_Z^{-1}(\tau_i) - b \cdot
F_Z^{-1}(\tau_i) = a\]</span></p>
<p>In the above expressions, we use the two smallest quantiles when
estimating the lower tail and the two largest quantiles when estimating
the upper tail. With these choices, by construction the lower tail
integrates to <span class="math inline">\(\tau_1\)</span> on the
interval <span class="math inline">\((-\infty, q_1]\)</span> and the
upper tail integrates to <span class="math inline">\(1 - \tau_K\)</span>
on the interval <span class="math inline">\([q_K, \infty)\)</span>.</p>
<p>As an alternative, we also allow for the use of a log-normal
distribution for extrapolation into the tails. The parameters of the
log-normal distribution are estimated by applying the approach outlined
above to the logarithms of the quantiles.</p>
</div>
<div class="section level3">
<h3 id="estimation-of-the-qf-and-pdf-and-random-deviate-generation">Estimation of the QF and PDF, and random deviate generation<a class="anchor" aria-label="anchor" href="#estimation-of-the-qf-and-pdf-and-random-deviate-generation"></a>
</h3>
<p>To estimate the QF, we invert the CDF estimate, allowing for jumps in
regions where the CDF is flat. As noted above, this can be numerically
unstable if <code>n_grid = NULL</code> (thus using the spline fit
directly), so it is recommended that the <code>n_grid</code> parameter
be set to an integer if QF estimates are desired.</p>
<p>To estimate the PDF in instances where the CDF estimate corresponds
to a continuous distribution, we differentiate the CDF estimate. If the
stage 2 CDF estimate is used, this yields a “histogram density”
estimate, which is discontinuous and piecewise constant. If this
presents a challenge, the grid size can be increased or the stage 1 CDF
estimate used instead.</p>
<p>Random deviates are obtained by sampling <span class="math inline">\(U \sim \text{Unif}(0,1)\)</span> and then
evaluating the approximated quantile function: <span class="math inline">\(Y = F_Y^{-1}(U)\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="illustration-of-package-functionality">Illustration of package functionality<a class="anchor" aria-label="anchor" href="#illustration-of-package-functionality"></a>
</h2>
<p>We illustrate the package functionality with a series of four
examples. The first example is a setting where the distribution is for a
continuous random variable with a defined probability density funciton.
The remaining examples illustrate the behavior of the functions in
settings where the provided quantiles are the same at multiple
probability levels or a lognormal distribution is used for tail
extrapolation and there is at least one quantile at zero, indicating
that there is some discrete component to the distribution.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://reichlab.io/distfromq/">distfromq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level3">
<h3 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h3>
<p>In our first example, we work with quantiles from the distribution
<span class="math inline">\(Y \sim \text{log normal}(4, 0.5)\)</span>.
We compare this predictive distribution with three approximations of it
that are derived from the quantiles using different assumptions for the
tail behavior:</p>
<ol style="list-style-type: decimal">
<li>The first assumes a log-normal distribution for the tails. This
method should reconstruct the true distribution.</li>
<li>The second assumes a normal distribution for the tails. This method
has a mismatch in the support of the lower tail (including values less
than 0), and has a thinner upper tail than the log-normal.</li>
<li>The third assumes a Cauchy distribution for the tails. This method
has a mismatch in the support of the lower tail (including values less
than 0), and has a heavier upper tail than the log-normal.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meanlog</span> <span class="op">&lt;-</span> <span class="fl">4.0</span></span>
<span><span class="va">sdlog</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">q_lognormal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">qlnorm</a></span><span class="op">(</span><span class="va">quantile_probs</span>, meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">400.0</span>, length <span class="op">=</span> <span class="fl">501</span><span class="op">)</span></span>
<span><span class="va">cdf_lognormal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">plnorm</a></span><span class="op">(</span><span class="va">x</span>, meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="va">cdf_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu">p_lognormal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that `tail_dist = "norm"` is the default; we specify it here for clarity</span></span>
<span><span class="va">p_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">cdf_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">p_normal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span><span class="va">cdf_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu">p_cauchy_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cdf_lognormal</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Log normal"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cdf_lognormal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nlog-normal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cdf_normal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nnormal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cdf_cauchy_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nCauchy tails"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">dist</span>, linetype <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">q_lognormal</span>, p <span class="op">=</span> <span class="va">quantile_probs</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">q</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<p>The following illustrates differences in the density estimates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_lognormal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">dlnorm</a></span><span class="op">(</span><span class="va">x</span>, meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span><span class="op">)</span></span>
<span><span class="va">pdf_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu">d_lognormal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">pdf_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">d_normal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">pdf_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu">d_cauchy_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_lognormal</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Log normal"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_lognormal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nlog-normal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_normal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nnormal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_cauchy_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nCauchy tails"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">q_lognormal</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">q</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">dist</span>, linetype <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<p>We emphasize that the density is a step function. We illustrate this
by setting the <code>n_grid</code> parameter to the artificially low
value of 1:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_lognormal_approx_n_grid_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span>,</span>
<span>                                interior_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_grid <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pdf_lognormal_approx_n_grid_1</span> <span class="op">&lt;-</span> <span class="fu">d_lognormal_approx_n_grid_1</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_lognormal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\n n_grid = 20"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pdf_lognormal_approx_n_grid_1</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\n n_grid = 1"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">q_lognormal</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">q</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.7</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>We can generate random deviates from the distribution estimates as
follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_r_fn.html">make_r_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">r_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_r_fn.html">make_r_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="va">r_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_r_fn.html">make_r_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span>                             </span>
<span><span class="va">normal_approx_sample</span> <span class="op">&lt;-</span> <span class="fu">r_normal_approx</span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">lognormal_approx_sample</span> <span class="op">&lt;-</span> <span class="fu">r_lognormal_approx</span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span>
<span><span class="va">cauchy_approx_sample</span> <span class="op">&lt;-</span> <span class="fu">r_cauchy_approx</span><span class="op">(</span>n<span class="op">=</span><span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">normal_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nnormal tails"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lognormal_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nlog-normal tails"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">cauchy_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nCauchy tails"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="va">dist</span>, linetype <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>The heavy tails of the Cauchy distribution dominate the display. Here
we restrict the range of the horizontal axis:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">normal_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nnormal tails"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lognormal_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nlog-normal tails"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">cauchy_approx_sample</span>, dist <span class="op">=</span> <span class="st">"Spline interpolation,\nCauchy tails"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, color <span class="op">=</span> <span class="va">dist</span>, linetype <span class="op">=</span> <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">300</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 268 rows containing non-finite values</span></span>
<span><span class="co">#&gt; (`stat_density()`).</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<p>Finally, we display quantile function estimates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.01</span>, to <span class="op">=</span> <span class="fl">0.99</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">q_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="va">q_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">q_lognormal</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"cauchy"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">quantiles_lognormal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">qlnorm</a></span><span class="op">(</span><span class="va">ps</span>, meanlog <span class="op">=</span> <span class="va">meanlog</span>, sdlog <span class="op">=</span> <span class="va">sdlog</span><span class="op">)</span></span>
<span><span class="va">quantiles_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">q_normal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="va">quantiles_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu">q_lognormal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="va">quantiles_cauchy_approx</span> <span class="op">&lt;-</span> <span class="fu">q_cauchy_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        y <span class="op">=</span> <span class="va">quantiles_lognormal</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Log normal"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        y <span class="op">=</span> <span class="va">quantiles_normal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nnormal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        y <span class="op">=</span> <span class="va">quantiles_lognormal_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nlognormal tails"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        y <span class="op">=</span> <span class="va">quantiles_cauchy_approx</span>,</span>
<span>        dist <span class="op">=</span> <span class="st">"Spline interpolation,\nCauchy tails"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">dist</span>, linetype <span class="op">=</span> <span class="va">dist</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span></span>
<span>            <span class="st">"Distribution"</span>,</span>
<span>            end <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">"Distribution"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Quantile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Probability Level"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="example-2-lognormal-tails-with-a-point-mass-at-0">Example 2: lognormal tails with a point mass at 0<a class="anchor" aria-label="anchor" href="#example-2-lognormal-tails-with-a-point-mass-at-0"></a>
</h3>
<p>A lognormal distribution specifies that <span class="math inline">\(P(X \leq 0) = 0\)</span>, i.e., the random
variable will always non-negative values. If a lognormal tail
distribution is used, e.g. to ensure that the distribution’s support is
non-negative and to capture a long right tail, the package inserts a
point mass at 0 if any provided quantiles are 0. We illustrate this
behavior in this example.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mixture of a LogNormal(4, 0.5) distribution with weight 0.8 and</span></span>
<span><span class="co"># a point mass at 0 with weight 0.2</span></span>
<span></span>
<span><span class="co"># probabilities and quantiles for the lognormal component</span></span>
<span><span class="va">lnorm_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">lnorm_qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">qlnorm</a></span><span class="op">(</span><span class="va">lnorm_ps</span>, meanlog <span class="op">=</span> <span class="fl">4.0</span>, sdlog <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">adj_lnorm_ps</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="op">+</span> <span class="va">lnorm_ps</span> <span class="op">*</span> <span class="fl">0.8</span></span>
<span></span>
<span><span class="co"># quantile at 0 with probability 0.2 for the point mass at 0</span></span>
<span><span class="va">point_p</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span><span class="va">point_q</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">point_p</span>, <span class="va">adj_lnorm_ps</span><span class="op">)</span></span>
<span><span class="va">qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">point_q</span>, <span class="va">lnorm_qs</span><span class="op">)</span></span></code></pre></div>
<p>Note that the cdf estimate is zero below 0, jumps to 0.2 at 0, and is
continuous thereafter.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">100.0</span>, to <span class="op">=</span> <span class="fl">400.0</span>, length <span class="op">=</span> <span class="fl">501</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">qs</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="va">cdf_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu">p_lognormal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">x</span>,</span>
<span>    y <span class="op">=</span> <span class="va">cdf_lognormal_approx</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">qs</span>, p <span class="op">=</span> <span class="va">ps</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">q</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<p>As expected, the quantile function inverts the cdf.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.00</span>, to <span class="op">=</span> <span class="fl">0.99</span>, by <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps</span>,</span>
<span>                                qs <span class="op">=</span> <span class="va">qs</span>,</span>
<span>                                tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="va">qf_lognormal_approx</span> <span class="op">&lt;-</span> <span class="fu">q_lognormal_approx</span><span class="op">(</span><span class="va">plot_ps</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">plot_ps</span>,</span>
<span>    y <span class="op">=</span> <span class="va">qf_lognormal_approx</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">ps</span>, p <span class="op">=</span> <span class="va">qs</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">q</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
<p>We can verify this by plotting the quantile function estimate with
inverted axes on the same display as the cdf estimate:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cdf_lognormal_approx</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"CDF Estimate"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">qf_lognormal_approx</span>,</span>
<span>        y <span class="op">=</span> <span class="va">plot_ps</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"Flipped QF Estimate"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">method</span>, linetype <span class="op">=</span> <span class="va">method</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">qs</span>, p <span class="op">=</span> <span class="va">ps</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">q</span>, y <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">1.2</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
<p>Samples from this distribution estimate will include a concentration
of values at 0:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_r_fn.html">make_r_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps</span>, qs <span class="op">=</span> <span class="va">qs</span>, tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sampled_values_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">r_fn</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sampled_values_df</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sampled_values_df</span><span class="op">$</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1983</span></span></code></pre></div>
<p>Because the distribution has a discrete component, we cannot produce
a density estimate:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_fn_lnorm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps</span>, qs <span class="op">=</span> <span class="va">qs</span>, tail_dist <span class="op">=</span> <span class="st">"lnorm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in make_d_fn(ps = ps, qs = qs, tail_dist = "lnorm"): make_d_fn requires the distribution to be continuous, but a discrete component was detected</span></span></code></pre></div>
<p>Note that we do not get an error when estimating the density with a
normal tail distribution, because in this case we are not forced to
assume that there is a point mass at 0:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_fn_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">ps</span>, qs <span class="op">=</span> <span class="va">qs</span>, tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3-duplicated-quantiles-on-the-interior">Example 3: duplicated quantiles on the interior<a class="anchor" aria-label="anchor" href="#example-3-duplicated-quantiles-on-the-interior"></a>
</h3>
<p>When quantile values are the same at multiple probability levels, the
distribution assigns non-zero probability to that value, corresponding
to a “step” or “jump” in the cumulative distribution function. Again, we
note that in this case, <code>make_d_fn</code> will throw an error
because a continuous density does not exist. We illustrate the behavior
of the estimates provided by <code>make_p_fn</code> and
<code>make_q_fn</code> in the presence of repeated quantiles in this and
the following example.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">quantile_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">8.0</span>, <span class="fl">9.0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_d_fn.html">make_d_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in make_d_fn(ps = quantile_probs, qs = quantile_values, tail_dist = "norm"): make_d_fn requires the distribution to be continuous, but a discrete component was detected</span></span>
<span><span class="va">p_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">q_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">r_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_r_fn.html">make_r_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">20.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">cdf_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">p_normal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">cdf_normal_approx</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_values</span>, y <span class="op">=</span> <span class="va">quantile_probs</span><span class="op">)</span>,</span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-16-1.png" width="100%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">qf_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">q_normal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">ps</span>, y <span class="op">=</span> <span class="va">qf_normal_approx</span><span class="op">)</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_probs</span>, y <span class="op">=</span> <span class="va">quantile_values</span><span class="op">)</span>,</span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-16-2.png" width="100%"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">samples_normal_approx</span> <span class="op">&lt;-</span> <span class="fu">r_normal_approx</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">samples_normal_approx</span> <span class="op">==</span> <span class="fl">3.0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4111</span></span></code></pre></div>
<p>We confirm here that the estimated CDF and QF are indeed inverses to
a high degree of numerical precision in regions where the distribution
is continuous:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span></span>
<span><span class="va">out_ps</span> <span class="op">&lt;-</span> <span class="fu">p_normal_approx</span><span class="op">(</span><span class="fu">q_normal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">out_ps</span></span>
<span><span class="co">#&gt;   [1] 0.00 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 0.10 0.11 0.12 0.13 0.14</span></span>
<span><span class="co">#&gt;  [16] 0.15 0.16 0.17 0.18 0.19 0.20 0.21 0.22 0.23 0.24 0.25 0.26 0.27 0.28 0.29</span></span>
<span><span class="co">#&gt;  [31] 0.30 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70</span></span>
<span><span class="co">#&gt;  [46] 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70</span></span>
<span><span class="co">#&gt;  [61] 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.70 0.71 0.72 0.73 0.74</span></span>
<span><span class="co">#&gt;  [76] 0.75 0.76 0.77 0.78 0.79 0.80 0.81 0.82 0.83 0.84 0.85 0.86 0.87 0.88 0.89</span></span>
<span><span class="co">#&gt;  [91] 0.90 0.91 0.92 0.93 0.94 0.95 0.96 0.97 0.98 0.99 1.00</span></span>
<span></span>
<span><span class="va">ps</span><span class="op">[</span><span class="op">(</span><span class="va">ps</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">ps</span> <span class="op">&gt;</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">out_ps</span><span class="op">[</span><span class="op">(</span><span class="va">ps</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">ps</span> <span class="op">&gt;</span> <span class="fl">0.7</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1]  0.000000e+00 -1.561251e-17 -3.469447e-18 -1.040834e-17  0.000000e+00</span></span>
<span><span class="co">#&gt;  [6] -2.775558e-17  2.775558e-17  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [11]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [16]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00 -2.775558e-17</span></span>
<span><span class="co">#&gt; [21]  0.000000e+00  0.000000e+00  2.775558e-17  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [26]  0.000000e+00  5.551115e-17  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [31]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [36]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [41]  0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00  1.110223e-16</span></span>
<span><span class="co">#&gt; [46]  0.000000e+00  0.000000e+00 -1.110223e-16  0.000000e+00 -1.110223e-16</span></span>
<span><span class="co">#&gt; [51]  0.000000e+00  0.000000e+00  1.110223e-16  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [56]  0.000000e+00  0.000000e+00  1.110223e-16  0.000000e+00  0.000000e+00</span></span>
<span><span class="co">#&gt; [61]  0.000000e+00</span></span></code></pre></div>
<p>As described earlier, we use a piecewise linear representation of the
CDF to avoid numerical issues that arise when inverting the monotonic
spline. We illustrate these problems by manually setting
<code>n_grid = NULL</code>, i.e., using the stage 1 CDF estimate based
directly on splines. The two representations of the CDF are generally
quite similar, but the QF estimates can differ substantially.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_normal_approx_spline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>                             interior_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_grid <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q_normal_approx_spline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>                             interior_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_grid <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">20.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        cdf <span class="op">=</span> <span class="fu">p_normal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"piecewise linear"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        cdf <span class="op">=</span> <span class="fu">p_normal_approx_spline</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"spline"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_df</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">cdf</span>, color <span class="op">=</span> <span class="va">type</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_values</span>, y <span class="op">=</span> <span class="va">quantile_probs</span><span class="op">)</span>,</span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        p <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        qf <span class="op">=</span> <span class="fu">q_normal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"piecewise linear"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        p <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        qf <span class="op">=</span> <span class="fu">q_normal_approx_spline</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"spline"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">qf</span>, color <span class="op">=</span> <span class="va">type</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_probs</span>, y <span class="op">=</span> <span class="va">quantile_values</span><span class="op">)</span>,</span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-19-1.png" width="100%"></p>
<p>We therefore recommend using the piecewise linear representation when
using a quantile function or generating random deviates, which uses the
quantile function in the background.</p>
</div>
<div class="section level3">
<h3 id="example-4-duplicated-quantiles-in-the-tails">Example 4: duplicated quantiles in the tails<a class="anchor" aria-label="anchor" href="#example-4-duplicated-quantiles-in-the-tails"></a>
</h3>
<p>Our final example illustrates the behavior when there are duplicated
quantiles at the edges. In these cases, we ignore the specified
<code>tail_dist</code>, and assume that the point mass at the edge
contains all of the tail probability.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">quantile_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.1</span>, to <span class="op">=</span> <span class="fl">0.9</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">quantile_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">1.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">3.0</span>, <span class="fl">9.0</span>, <span class="fl">9.0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">p_normal_approx_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_p_fn.html">make_p_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>                             interior_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_grid <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">q_normal_approx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span><span class="va">q_normal_approx_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_q_fn.html">make_q_fn</a></span><span class="op">(</span>ps <span class="op">=</span> <span class="va">quantile_probs</span>,</span>
<span>                             qs <span class="op">=</span> <span class="va">quantile_values</span>,</span>
<span>                             tail_dist <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>                             interior_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_grid <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">20.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        cdf <span class="op">=</span> <span class="fu">p_normal_approx</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"spline"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        cdf <span class="op">=</span> <span class="fu">p_normal_approx_lin</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"piecewise linear"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_df</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">cdf</span>, color <span class="op">=</span> <span class="va">type</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_values</span>, y <span class="op">=</span> <span class="va">quantile_probs</span><span class="op">)</span>,</span>
<span>             mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-20-1.png" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.0</span>, to <span class="op">=</span> <span class="fl">1.0</span>, length <span class="op">=</span> <span class="fl">5001</span><span class="op">)</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        p <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        qf <span class="op">=</span> <span class="fu">q_normal_approx</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"spline"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        p <span class="op">=</span> <span class="va">ps</span>,</span>
<span>        qf <span class="op">=</span> <span class="fu">q_normal_approx_lin</span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"piecewise linear"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_df</span>,</span>
<span>              mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">p</span>, y <span class="op">=</span> <span class="va">qf</span>, color <span class="op">=</span> <span class="va">type</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">quantile_probs</span>, y <span class="op">=</span> <span class="va">quantile_values</span><span class="op">)</span>,</span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="distfromq_files/figure-html/unnamed-chunk-21-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Evan Ray, Aaron Gerding.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
